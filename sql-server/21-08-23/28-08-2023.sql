/* PROBLEM STATEMENT :- Create one database which should keep 32 people information, salary information, daily attendance  */

CREATE DATABASE AUG21;

USE AUG21;

/* CREATING EMPLOYEE TABLE */

CREATE TABLE EMPLOYEE(
ID INT IDENTITY(55,1) PRIMARY KEY,
EMP_NAME VARCHAR(55),
R_DATE DATETIME
);

/* ALTER TABLE EMPLOYEE TO ADD LEAVES */

ALTER TABLE EMPLOYEE
ADD WORK_DAYS INT;

SELECT * FROM EMPLOYEE;

/* COUNTING DATE AND ASSIGN IT IN WORKING DATE */

SELECT * FROM EMPLOYEE;

UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55)
WHERE ID = 55;

UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 56)
WHERE ID = 56;

SELECT * FROM EMPLOYEE;

/* ADDING EMPLOYEE */

INSERT INTO EMPLOYEE(EMP_NAME,R_DATE) VALUES ('RAHUL MALHOTRA','2021-05-21'),('KUSHI SINHA','2021-03-06');

SELECT * FROM EMPLOYEE;

/* CREATING BANK TABLE */

CREATE TABLE BANK (
ACC_NO INT IDENTITY(100,1) PRIMARY KEY,
BANK_NAME VARCHAR(55),
BANK_IFSC VARCHAR(15),
EMP_ID INT FOREIGN KEY REFERENCES EMPLOYEE(ID)
);


/* INSERTING INTO BANK */

INSERT INTO BANK (BANK_NAME,BANK_IFSC,EMP_ID) VALUES ('HDFC BANK','HDFC0123456',55),('PUNJAB NATIONAL BANK','PNB0123456',56);

SELECT * FROM BANK;

SELECT BANK_NAME , EMP_NAME,EMP_ID FROM EMPLOYEE
INNER JOIN BANK 
ON BANK.EMP_ID = EMPLOYEE.ID;

/* CREATING ATTENDANCE TABLE */

CREATE TABLE ATTENDANCE (
ID INT IDENTITY(1,1) PRIMARY KEY,
IN_TIME DATETIME,
OUT_TIME DATETIME,
EMP_ID INT FOREIGN KEY REFERENCES EMPLOYEE(ID)
);

/* INSERT VALUES INTO ATTENDANCE */

INSERT INTO ATTENDANCE(IN_TIME,OUT_TIME,EMP_ID) 
VALUES('2022-01-01 08:33','2022-01-01 06:53',55),
('2022-01-02 08:33','2022-01-02 06:53',55),
('2022-01-03 08:33','2022-01-03 06:53',55),
('2022-01-04 08:33','2022-01-04 06:53',55),
('2022-01-05 08:33','2022-01-05 06:53',55),
('2022-01-06 08:33','2022-01-06 06:53',55),
('2022-01-07 08:33','2022-01-07 06:53',55);

INSERT INTO ATTENDANCE(IN_TIME,OUT_TIME,EMP_ID) VALUES
('2022-01-02 08:33','2022-01-02 06:53',56),
('2022-01-03 08:33','2022-01-03 06:53',56),
('2022-01-04 08:33','2022-01-04 06:53',56),
('2022-01-05 08:33','2022-01-05 06:53',56),
('2022-01-06 08:33','2022-01-06 06:53',56),
('2022-01-07 08:33','2022-01-07 06:53',56);

SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55 AND OUT_TIME > '05:00:00';

SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55;


/* CREATING SALARY TABLE */

CREATE TABLE SALARY(
ID INT IDENTITY(1,1) PRIMARY KEY,
AMOUNT MONEY,
CREDIT_DATE DATETIME,
FOR_MONTH DATETIME,
EMP_ID INT FOREIGN KEY REFERENCES EMPLOYEE(ID)
);


INSERT INTO SALARY (AMOUNT,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES (32000,'2021-01-01 08:33','2020-12-31 08:33',55),
(32000,'2021-02-01 08:33','2021-01-31 08:33',55);


INSERT INTO SALARY (AMOUNT,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES (32000,'2021-01-01 08:33','2020-12-31 08:33',56),
(32000,'2021-02-01 08:33','2021-01-31 08:33',56);

SELECT SALARY.EMP_ID,EMPLOYEE.EMP_NAME,SALARY.FOR_MONTH,SALARY.AMOUNT,SALARY.CREDIT_DATE,EMPLOYEE.WORK_DAYS FROM EMPLOYEE
INNER JOIN  SALARY
ON SALARY.EMP_ID = EMPLOYEE.ID AND EMPLOYEE.ID = 55;




UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55)
WHERE ID = 55;

UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 56)
WHERE ID = 56;


/*  ---------------------- POST LUNCH SESSION TASK ----------------------- */

/* CREATING TABLE EMP1 */

CREATE TABLE EMP1(
EMP_ID INT IDENTITY(1,1),
EMP_NAME VARCHAR(55),
PRIMARY KEY(EMP_ID,EMP_NAME)
);

/* CREATING TABLE SAL1 */
CREATE TABLE SAL1(
TXN INT IDENTITY(101,1) PRIMARY KEY,
EMP_NAME VARCHAR(55),
CREDIT_DATE DATETIME,
FOR_MONTH DATETIME,
EMP_ID INT,
/* CREATING MULTIPLE FOREIGN KEY */
FOREIGN KEY(EMP_ID,EMP_NAME) REFERENCES EMP1(EMP_ID,EMP_NAME)
);


/* INSERTING VALUES IN EMP1 */


INSERT INTO EMP1(EMP_NAME)
VALUES ('RAVI KISHOR'),
('HARSH JHA'),
('RAHUL TANEJA'),
('LALU YADAV');

/* INSERTING VALUES IN SAL1 */

INSERT INTO SAL1(EMP_NAME,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES ('RAVI KISHOR','2021-04-01','2021-03-31',1),
('HARSH JHA','2021-04-01','2021-03-31',2),
('RAHUL TANEJA','2021-04-01','2021-03-31',3),
('LALU YADAV','2021-04-01','2021-03-31',4);

SELECT * FROM EMP1;

SELECT * FROM SAL1;


INSERT INTO SAL1(EMP_NAME,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES ('RAVI KISHOR','2021-04-01','2021-03-31',88),
('MOHAN KISHOR','2021-04-01','2021-03-31',1);
