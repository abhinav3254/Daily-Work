/* PROBLEM STATEMENT :- Create one database which should keep 32 people information, salary information, daily attendance  */

CREATE DATABASE AUG21;

USE AUG21;

/* CREATING EMPLOYEE TABLE */

CREATE TABLE EMPLOYEE(
ID INT IDENTITY(55,1) PRIMARY KEY,
EMP_NAME VARCHAR(55),
R_DATE DATETIME
);

/* ALTER TABLE EMPLOYEE TO ADD LEAVES */

ALTER TABLE EMPLOYEE
ADD WORK_DAYS INT;

SELECT * FROM EMPLOYEE;

/* COUNTING DATE AND ASSIGN IT IN WORKING DATE */

SELECT * FROM EMPLOYEE;

UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55)
WHERE ID = 55;

UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 56)
WHERE ID = 56;

SELECT * FROM EMPLOYEE;

/* ADDING EMPLOYEE */

INSERT INTO EMPLOYEE(EMP_NAME,R_DATE) VALUES ('RAHUL MALHOTRA','2021-05-21'),('KUSHI SINHA','2021-03-06');

SELECT * FROM EMPLOYEE;

/* CREATING BANK TABLE */

CREATE TABLE BANK (
ACC_NO INT IDENTITY(100,1) PRIMARY KEY,
BANK_NAME VARCHAR(55),
BANK_IFSC VARCHAR(15),
EMP_ID INT FOREIGN KEY REFERENCES EMPLOYEE(ID)
);


/* INSERTING INTO BANK */

INSERT INTO BANK (BANK_NAME,BANK_IFSC,EMP_ID) VALUES ('HDFC BANK','HDFC0123456',55),('PUNJAB NATIONAL BANK','PNB0123456',56);

SELECT * FROM BANK;

SELECT BANK_NAME , EMP_NAME,EMP_ID FROM EMPLOYEE
INNER JOIN BANK 
ON BANK.EMP_ID = EMPLOYEE.ID;

/* CREATING ATTENDANCE TABLE */

CREATE TABLE ATTENDANCE (
ID INT IDENTITY(1,1) PRIMARY KEY,
IN_TIME DATETIME,
OUT_TIME DATETIME,
EMP_ID INT FOREIGN KEY REFERENCES EMPLOYEE(ID)
);

/* INSERT VALUES INTO ATTENDANCE */

INSERT INTO ATTENDANCE(IN_TIME,OUT_TIME,EMP_ID) 
VALUES('2022-01-01 08:33','2022-01-01 06:53',55),
('2022-01-02 08:33','2022-01-02 06:53',55),
('2022-01-03 08:33','2022-01-03 06:53',55),
('2022-01-04 08:33','2022-01-04 06:53',55),
('2022-01-05 08:33','2022-01-05 06:53',55),
('2022-01-06 08:33','2022-01-06 06:53',55),
('2022-01-07 08:33','2022-01-07 06:53',55);

INSERT INTO ATTENDANCE(IN_TIME,OUT_TIME,EMP_ID) VALUES
('2022-01-02 08:33','2022-01-02 06:53',56),
('2022-01-03 08:33','2022-01-03 06:53',56),
('2022-01-04 08:33','2022-01-04 06:53',56),
('2022-01-05 08:33','2022-01-05 06:53',56),
('2022-01-06 08:33','2022-01-06 06:53',56),
('2022-01-07 08:33','2022-01-07 06:53',56);

SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55 AND OUT_TIME > '05:00:00';

SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55;


/* CREATING SALARY TABLE */

CREATE TABLE SALARY(
ID INT IDENTITY(1,1) PRIMARY KEY,
AMOUNT MONEY,
CREDIT_DATE DATETIME,
FOR_MONTH DATETIME,
EMP_ID INT FOREIGN KEY REFERENCES EMPLOYEE(ID)
);


INSERT INTO SALARY (AMOUNT,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES (32000,'2021-01-01 08:33','2020-12-31 08:33',55),
(32000,'2021-02-01 08:33','2021-01-31 08:33',55);


INSERT INTO SALARY (AMOUNT,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES (32000,'2021-01-01 08:33','2020-12-31 08:33',56),
(32000,'2021-02-01 08:33','2021-01-31 08:33',56);

SELECT SALARY.EMP_ID,EMPLOYEE.EMP_NAME,SALARY.FOR_MONTH,SALARY.AMOUNT,SALARY.CREDIT_DATE,EMPLOYEE.WORK_DAYS FROM EMPLOYEE
INNER JOIN  SALARY
ON SALARY.EMP_ID = EMPLOYEE.ID AND EMPLOYEE.ID = 55;




UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 55)
WHERE ID = 55;

UPDATE EMPLOYEE
SET WORK_DAYS = (SELECT COUNT(*) FROM ATTENDANCE WHERE EMP_ID = 56)
WHERE ID = 56;


/*  ---------------------- POST LUNCH SESSION TASK ----------------------- */

/* CREATING TABLE EMP1 */

CREATE TABLE EMP1(
EMP_ID INT IDENTITY(1,1),
EMP_NAME VARCHAR(55),
PRIMARY KEY(EMP_ID,EMP_NAME)
);

/* CREATING TABLE SAL1 */
CREATE TABLE SAL1(
TXN INT IDENTITY(101,1) PRIMARY KEY,
EMP_NAME VARCHAR(55),
CREDIT_DATE DATETIME,
FOR_MONTH DATETIME,
EMP_ID INT,
/* CREATING MULTIPLE FOREIGN KEY */
/* ONE THING TO NOTE HERE IS THAT COMBINATION OF EMP_ID+EMP_NAME = FOREIGN KEY NOT A SINGLE VALUE */
FOREIGN KEY(EMP_ID,EMP_NAME) REFERENCES EMP1(EMP_ID,EMP_NAME)
);


/* INSERTING VALUES IN EMP1 */


INSERT INTO EMP1(EMP_NAME)
VALUES ('RAVI KISHOR'),
('HARSH JHA'),
('RAHUL TANEJA'),
('LALU YADAV');

INSERT INTO EMP1(EMP_NAME)
VALUES('HARSH JHA');

/* INSERTING VALUES IN SAL1 */

INSERT INTO SAL1(EMP_NAME,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES ('RAVI KISHOR','2021-04-01','2021-03-31',1),
('HARSH JHA','2021-04-01','2021-03-31',2),
('RAHUL TANEJA','2021-04-01','2021-03-31',3),
('LALU YADAV','2021-04-01','2021-03-31',4);

INSERT INTO SAL1(EMP_NAME,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES ('HARSH JHA','2021-04-01','2021-03-31',5),
('HARSH JHA','2021-05-01','2021-04-01',2);

SELECT * FROM EMP1;

SELECT * FROM SAL1;


INSERT INTO SAL1(EMP_NAME,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES ('RAVI KISHOR','2021-04-01','2021-03-31',88),
('MOHAN KISHOR','2021-04-01','2021-03-31',1);


SELECT * FROM EMP1;

SELECT * FROM SAL1;


SELECT EMP1.EMP_NAME,SAL1.CREDIT_DATE FROM EMP1
INNER JOIN SAL1
ON EMP1.EMP_ID = SAL1.EMP_ID AND EMP1.EMP_ID = 1;


DELETE FROM SAL1 WHERE SAL1.TXN = 115;

ALTER TABLE EMP1
ADD AGE INT;

SELECT * FROM EMP1;


ALTER TABLE SAL1
DROP CONSTRAINT FK__SAL1__7C4F7684;


EXEC SP_HELP SAL1;

INSERT INTO SAL1(EMP_NAME,CREDIT_DATE,FOR_MONTH,EMP_ID)
VALUES ('RAVI KISHOR','2021-04-01','2021-03-31',88);


CREATE TABLE EMP2(
EMP_ID INT IDENTITY(1,1) PRIMARY KEY,
EMP_NAME VARCHAR(55),
EMP_SALARY MONEY
);

ALTER TABLE EMP2
ADD CHECK(EMP_SALARY>50000);

ALTER TABLE EMP2
ADD CONSTRAINT DF_EMP_NAME
DEFAULT 'PROLIFICS' FOR EMP_NAME;

ALTER TABLE EMP2
ADD CONSTRAINT DF_EMP_SAL
DEFAULT 0 FOR EMP_SALARY;

ALTER TABLE EMP2
ADD GENDER VARCHAR(10);

ALTER TABLE EMP2
ADD CONSTRAINT EMP_GENDER
DEFAULT 'MALE' FOR GENDER;

INSERT INTO EMP2(EMP_SALARY) VALUES(1211111);

SELECT * FROM EMP2;

/*  CREATING TABLE EMP3  */

drop table emp3;

CREATE TABLE EMP3(
ID INT IDENTITY(1,1) PRIMARY KEY,
E_NAME VARCHAR(55),
E_SALARY MONEY CHECK(E_SALARY>50000)
DEFAULT 50001
);

ALTER TABLE EMP3
ADD CONSTRAINT EMP3_SALARY
DEFAULT 50001 FOR E_SALARY;

INSERT INTO EMP3(E_NAME,E_SALARY) VALUES ('NARENDRA MODI',600000);

SELECT * FROM EMP3;

INSERT INTO EMP3(E_NAME) VALUES ('YOGI ADITYANATH');

/* ASSIGNMENT -3 */


/* EMPLOYEE NAME */
CREATE TABLE EMP4(
EMP_ID INT IDENTITY(1,1) PRIMARY KEY,
EMP_NAME VARCHAR(55) DEFAULT 'PROLIFICS',
EMP_REGISTER DATETIME NOT NULL,
EMP_SALARY MONEY CHECK(EMP_SALARY > 10000) DEFAULT 11000
);


/* SALARY TABLE */
CREATE TABLE SAL4(
TXN INT IDENTITY(101,1) PRIMARY KEY,
EMP_ID INT FOREIGN KEY REFERENCES EMP4(EMP_ID),
CREDIT_DATE DATETIME NOT NULL,
FOR_MONTH DATETIME NOT NULL
);


/* INSERTING INTO EMPLOYEE TABLE */
INSERT INTO EMP4(EMP_NAME,EMP_REGISTER) VALUES ('RAJAN MALHOTRA','2021-08-21');

SELECT * FROM EMP4;

INSERT INTO EMP4(EMP_REGISTER) VALUES ('2021-08-21');

INSERT INTO EMP4(EMP_NAME,EMP_REGISTER,EMP_SALARY) VALUES ('SURAJ KUMAR', '2021-09-04',18000);

INSERT INTO SAL4(EMP_ID,CREDIT_DATE,FOR_MONTH)
VALUES (2,'2021-09-01','2021-08-31');

INSERT INTO SAL4(EMP_ID,CREDIT_DATE,FOR_MONTH)
VALUES (21,'2021-09-01','2021-08-31');

SELECT * FROM EMP4;
SELECT * FROM SAL4;